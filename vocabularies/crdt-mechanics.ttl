@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix crdt: <https://kkalass.github.io/solid_crdt_sync/vocab/crdt-mechanics#> .
@prefix solid: <http://www.w3.org/ns/solid/terms#> .

# --- Ontology Definition ---

<https://kkalass.github.io/solid_crdt_sync/vocab/crdt-mechanics#> a owl:Ontology;
    rdfs:label "CRDT Framework Mechanics Vocabulary";
    rdfs:comment "A vocabulary defining the low-level operational mechanics and infrastructure properties required for CRDT synchronization coordination, including hybrid logical clocks, installation management, and deletion handling." .

# --- Framework Infrastructure Classes ---

crdt:ClockEntry a rdfs:Class;
    rdfs:label "Clock Entry";
    rdfs:comment "A single entry in a Hybrid Logical Clock (HLC), mapping an installation ID to both its logical time (causality counter) and physical time (wall-clock timestamp for tie-breaking)." .

crdt:ClientInstallation a rdfs:Class;
    rdfs:label "Client Installation";
    rdfs:comment "A unique installation of a CRDT-enabled application, providing traceability and identity for Hybrid Logical Clock entries across the distributed system." .

# --- Hybrid Logical Clock Properties ---

crdt:hasClockEntry a rdf:Property;
    rdfs:label "has clock entry";
    rdfs:comment "Links a resource to a blank node representing a single entry in its Hybrid Logical Clock (HLC). Each entry tracks both logical time (causality) and physical time (for intuitive tie-breaking) for one installation.";
    rdfs:domain rdfs:Resource;
    rdfs:range crdt:ClockEntry .

crdt:installationId a rdf:Property;
    rdfs:label "installation ID";
    rdfs:comment "The unique identifier for a client installation within a Hybrid Logical Clock entry. Corresponds to 'client ID' in CRDT literature, but uses 'installation' to avoid confusion with Solid OIDC client identifiers.";
    rdfs:domain crdt:ClockEntry;
    rdfs:range rdfs:Resource . # Should be an IRI

crdt:logicalTime a rdf:Property;
    rdfs:label "logical time";
    rdfs:comment "The logical time component of a Hybrid Logical Clock entry - a monotonically increasing counter that tracks causality relationships between operations. Provides tamper-proof causality tracking even when physical clocks are manipulated.";
    rdfs:domain crdt:ClockEntry;
    rdfs:range xsd:long .

crdt:physicalTime a rdf:Property;
    rdfs:label "physical time";
    rdfs:comment "The physical time component of a Hybrid Logical Clock entry - wall-clock timestamp in milliseconds since Unix epoch. Used for intuitive tie-breaking when operations are truly concurrent (logical times don't establish dominance).";
    rdfs:domain crdt:ClockEntry;
    rdfs:range xsd:long .

crdt:clockHash a rdf:Property;
    rdfs:label "clock hash";
    rdfs:comment "A pre-calculated, lightweight hash of the resource's full Hybrid Logical Clock, used for efficient change detection in indices. Hash includes both logical and physical time components. Domain is kept general (rdfs:Resource) to allow usage in various contexts including idx:ShardEntry instances.";
    rdfs:domain rdfs:Resource;
    rdfs:range xsd:string .

# --- Installation Management Properties ---

crdt:belongsToWebID a rdf:Property;
    rdfs:label "belongs to WebID";
    rdfs:comment "Links an installation to the WebID that owns it.";
    rdfs:domain crdt:ClientInstallation;
    rdfs:range rdfs:Resource .

crdt:applicationId a rdf:Property;
    rdfs:label "application ID";
    rdfs:comment "The unique identifier for the application that created this installation - the Client ID in Solid OIDC Terms.";
    rdfs:domain crdt:ClientInstallation;
    rdfs:range rdfs:Resource .

crdt:createdAt a rdf:Property;
    rdfs:label "created at";
    rdfs:comment "Timestamp when this installation was created.";
    rdfs:domain crdt:ClientInstallation;
    rdfs:range xsd:dateTime .

crdt:lastActiveAt a rdf:Property;
    rdfs:label "last active at";
    rdfs:comment "Timestamp of the last activity from this installation. Updated collaboratively by other installations to track dormancy.";
    rdfs:domain crdt:ClientInstallation;
    rdfs:range xsd:dateTime .

crdt:maxInactivityPeriod a rdf:Property;
    rdfs:label "maximum inactivity period";
    rdfs:comment "Duration after which this installation should be considered for tombstoning if no activity is detected. Expressed as ISO 8601 duration (e.g., 'P6M' for 6 months). If not specified, uses framework default.";
    rdfs:domain crdt:ClientInstallation;
    rdfs:range xsd:duration .

# --- Deletion and Cleanup Properties ---

crdt:deletedAt a rdf:Property;
    rdfs:label "deleted at";
    rdfs:comment "Framework-managed timestamp marking when a document or property value was deleted. Uses OR-Set semantics to support deletion/undeletion cycles for IRI reuse scenarios. Applied to documents (all-or-nothing cleanup of entire document and all contained resources) and individual property values (via RDF Reification statements). Applications control deletion through framework APIs rather than directly manipulating this property. Resource/value is considered deleted if this property has any values. For cleanup, use the latest timestamp plus retention period.";
    rdfs:domain [ a owl:Class; owl:unionOf (rdfs:Resource rdf:Statement) ];
    rdfs:range xsd:dateTime .

# --- Retention Policy Configuration ---

crdt:documentTombstoneRetentionPeriod a rdf:Property;
    rdfs:label "document tombstone retention period";
    rdfs:comment "Duration to retain document tombstones (complete deleted documents) before garbage collection. Expressed as ISO 8601 duration (e.g., 'P2Y' for 2 years). Applied to Type Index (for defaults) or Type Index registrations (for per-type overrides). Longer retention recommended due to high impact of zombie deletions affecting recreated documents.";
    rdfs:domain [ a owl:Class; owl:unionOf (solid:TypeIndex solid:TypeRegistration) ];
    rdfs:range xsd:duration .

crdt:enableDocumentTombstoneCleanup a rdf:Property;
    rdfs:label "enable document tombstone cleanup";
    rdfs:comment "Boolean flag indicating whether the framework should automatically clean up document tombstones after the retention period. Applied to Type Index (for defaults) or Type Index registrations (for per-type overrides).";
    rdfs:domain [ a owl:Class; owl:unionOf (solid:TypeIndex solid:TypeRegistration) ];
    rdfs:range xsd:boolean .

crdt:propertyTombstoneRetentionPeriod a rdf:Property;
    rdfs:label "property tombstone retention period";
    rdfs:comment "Duration to retain property tombstones (deleted values within multi-value properties) before garbage collection. Expressed as ISO 8601 duration (e.g., 'P6M' for 6 months). Applied to Type Index (for defaults) or Type Index registrations (for per-type overrides). Shorter retention acceptable due to lower impact of zombie deletions.";
    rdfs:domain [ a owl:Class; owl:unionOf (solid:TypeIndex solid:TypeRegistration) ];
    rdfs:range xsd:duration .

crdt:enablePropertyTombstoneCleanup a rdf:Property;
    rdfs:label "enable property tombstone cleanup";
    rdfs:comment "Boolean flag indicating whether the framework should automatically clean up property tombstones after the retention period. Applied to Type Index (for defaults) or Type Index registrations (for per-type overrides).";
    rdfs:domain [ a owl:Class; owl:unionOf (solid:TypeIndex solid:TypeRegistration) ];
    rdfs:range xsd:boolean .